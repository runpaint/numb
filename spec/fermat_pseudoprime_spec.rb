describe Integer, "#fermat_pseudoprime?" do
  @seq = {
          # A005935 
    3 =>  [91,121,286,671,703,949,1105,1541,1729,1891,2465,
           2665,2701,2821,3281,3367,3751,4961,5551,6601,7381,
           8401,8911,10585,11011,12403,14383,15203,15457,
           15841,16471,16531,18721,19345,23521,24046,24661,
           24727,28009,29161].to_seq,
          # A020136
    4 =>  [15,85,91,341,435,451,561,645,703,1105,1247,1271,
           1387,1581,1695,1729,1891,1905,2047,2071,2465,2701,
           2821,3133,3277,3367,3683,4033,4369,4371,4681,4795,
           4859,5461,5551,6601,6643,7957,8321,8481,8695,8911,
           9061,9131].to_seq,
          # A005936
    5 =>  [4,124,217,561,781,1541,1729,1891,2821,4123,5461,
           5611,5662,5731,6601,7449,7813,8029,8911,9881,
           11041,11476,12801,13021,13333,13981,14981,15751,
           15841,16297,17767,21361,22791,23653,24211,25327,
           25351,29341,29539].to_seq,
           # A005937
    6 =>  [35,185,217,301,481,1105,1111,1261,1333,1729,2465,
           2701,2821,3421,3565,3589,3913,4123,4495,5713,6533,
           6601,8029,8365,8911,9331,9881,10585,10621,11041,
           11137,12209,14315,14701,15841,16589,17329,18361,
           18721].to_seq,
          # A005938
    7 =>  [6,25,325,561,703,817,1105,1825,2101,2353,2465,
           3277,4525,4825,6697,8321,10225,10585,10621,11041,
           11521,12025,13665,14089,16725,16806,18721,19345,
           20197,20417,20425,22945,25829,26419,29234,29341,
           29857,29891,30025,30811].to_seq,
          # A020137
    8 =>  [9,21,45,63,65,105,117,133,153,231,273,341,481,
           511,561,585,645,651,861,949,1001,1105,1281,1365,
           1387,1417,1541,1649,1661,1729,1785,1905,2047,2169,
           2465,2501,2701,2821,3145,3171,3201,3277,3605,3641,
           4005,4033,4097].to_seq,
          # A020138
    9 =>  [4,8,28,52,91,121,205,286,364,511,532,616,671,697,
           703,946,949,1036,1105,1288,1387,1541,1729,1891,
           2465,2501,2665,2701,2806,2821,2926,3052,3281,3367,
           3751,4376,4636,4961,5356,5551,6364,6601,6643,7081,
           7381,7913,8401].to_seq,
          # A005939
    10 => [9,33,91,99,259,451,481,561,657,703,909,1233,1729,
           2409,2821,2981,3333,3367,4141,4187,4521,5461,6533,
           6541,6601,7107,7471,7777,8149,8401,8911,10001,
           11111,11169,11649,12403,12801,13833,13981,14701,
           14817,14911,15211].to_seq
  }

  @seq.each do |base, members|
    members.each do |n|
      next unless (n-2) >= base 
      it "should return true for Fermat-pseudoprime #{n} in base #{base}" do
        n.fermat_pseudoprime?(base).should be_true
      end

      next unless base == 10
      it "should return true for Fermat-pseudoprime #{n} (assuming base 10)" do
        n.should be_fermat_pseudoprime
      end
    end

    members.invert.sample(10).each do |n|
      next unless (n-2) >= base 
      it "should return false for non-Fermat-pseudoprime #{n} in base #{base}" do
        n.fermat_pseudoprime?(base).should be_false
      end

      next unless base == 10
      it "should return false for non-Fermat-pseudoprime #{n} (assuming base 10)" do
        n.should_not be_fermat_pseudoprime
      end
    end
  end
end
